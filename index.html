<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Estruturador 6Âº BPM</title>
    
    <link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/commons/b/bc/Bras%C3%A3o_da_PMPR.svg">
    <link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/b/bc/Bras%C3%A3o_da_PMPR.svg">
    
    <style>
        :root { --pmpr-blue: #002244; --pmpr-gold: #c5a059; }
        body { font-family: sans-serif; background: #1a202c; color: white; margin: 0; padding: 10px; }
        .header { text-align: center; padding: 15px; background: #000; border-radius: 10px; margin-bottom: 15px; border-bottom: 3px solid var(--pmpr-gold); }
        .grade { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-vtr { background: #2d3748; padding: 20px; border-radius: 10px; text-align: center; cursor: pointer; border: 1px solid #4a5568; position: relative; }
        .btn-vtr.active { border-color: var(--pmpr-gold); background: #3e4a5e; }
        .badge-mod { font-size: 10px; background: var(--pmpr-gold); color: black; padding: 2px 5px; border-radius: 4px; position: absolute; top: 5px; right: 5px; }
        .passo { display: none; background: #2d3748; padding: 15px; border-radius: 10px; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 5px; border: 1px solid #4a5568; background: #1a202c; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #2f855a; color: white; border: none; border-radius: 8px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .btn-voltar { background: #718096; }
        .linha-policial { display: flex; gap: 5px; margin-bottom: 10px; }
        .input-grad { width: 30% !important; }
        .input-nome { width: 70% !important; }
    </style>
</head>
<body>

    <div class="header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/bc/Bras%C3%A3o_da_PMPR.svg" style="height: 50px;">
        <h2 style="margin:5px 0 0 0; font-size: 1.2rem;">6Âº BPM - ESTRUTURADOR</h2>
        <div id="status" style="font-size: 0.7rem; color: #94a3b8;">Sincronizando...</div>
    </div>

    <div id="passo1" style="display: block;">
        <div class="grade" id="grade-equipes"></div>
        <button onclick="abrirMenuCadastro()" style="background:#4a5568; margin-top:20px;">âž• NOVO SETOR/VTR</button>
    </div>

    <div id="passo2" class="passo">
        <h3 id="vtr-titulo"></h3>
        <div id="container-policiais"></div>
        <button onclick="adicionarCampoPolicial('', '')" style="background:#2b6cb0">+ ADICIONAR POLICIAL</button>
        <button onclick="prosseguirParaRelato()">SALVAR E CONTINUAR</button>
        <button class="btn-voltar" onclick="voltarPara(1)">VOLTAR</button>
    </div>

    <div id="passo3" class="passo">
        <h3>GERAR ESTRUTURA</h3>
        <label>Relato da OcorrÃªncia:</label>
        <textarea id="relato-bruto" placeholder="Cole aqui o texto da ocorrÃªncia..."></textarea>
        <button onclick="gerarTextoFinal()" style="background:#c5a059; color: black;">GERAR ESTRUTURA</button>
        <button class="btn-voltar" onclick="voltarPara(2)">VOLTAR</button>
    </div>

    <script>
        const URL_APPS_SCRIPT = "COLE_AQUI_SEU_LINK_DO_GOOGLE_SCRIPT";
        let db = {};
        let vtrSelecionada = "";

        async function carregarDados() {
            try {
                const r = await fetch(URL_APPS_SCRIPT);
                db = await r.json();
                renderizarBotoes();
                document.getElementById('status').innerText = "âœ… CONECTADO";
            } catch (e) {
                document.getElementById('status').innerText = "âš ï¸ MODO OFFLINE";
                console.error(e);
            }
        }

        function renderizarBotoes() {
            const grade = document.getElementById('grade-equipes');
            grade.innerHTML = "";
            Object.keys(db).forEach(vtr => {
                const div = document.createElement('div');
                div.className = 'btn-vtr';
                div.innerHTML = `<span class="badge-mod">${db[vtr].modalidade}</span>ðŸš”<br>${vtr}`;
                div.onclick = () => abrirPasso2(vtr);
                grade.appendChild(div);
            });
        }

        function abrirPasso2(vtr) {
            vtrSelecionada = vtr;
            document.getElementById('passo1').style.display = 'none';
            document.getElementById('passo2').style.display = 'block';
            document.getElementById('vtr-titulo').innerText = "VTR: " + vtr;
            
            const container = document.getElementById('container-policiais');
            container.innerHTML = "";
            const policiais = db[vtr].policiais || [];
            
            if (policiais.length === 0) {
                adicionarCampoPolicial('', '');
            } else {
                policiais.forEach(p => adicionarCampoPolicial(p.g, p.n));
            }
        }

        function adicionarCampoPolicial(grad, nome) {
            const container = document.getElementById('container-policiais');
            const div = document.createElement('div');
            div.className = 'linha-policial';
            div.innerHTML = `
                <input type="text" placeholder="Grad" value="${grad}" class="input-grad">
                <input type="text" placeholder="Nome" value="${nome}" class="input-nome">
            `;
            container.appendChild(div);
        }

        async function prosseguirParaRelato() {
            const linhas = document.querySelectorAll('.linha-policial');
            let novosPoliciais = [];
            linhas.forEach(l => {
                const g = l.querySelector('.input-grad').value;
                const n = l.querySelector('.input-nome').value;
                if(n) novosPoliciais.push({g: g, n: n});
            });

            db[vtrSelecionada].policiais = novosPoliciais;
            
            // Salva na planilha
            document.getElementById('status').innerText = "ðŸ’¾ SALVANDO...";
            fetch(URL_APPS_SCRIPT, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(db)
            });

            document.getElementById('passo2').style.display = 'none';
            document.getElementById('passo3').style.display = 'block';
            document.getElementById('status').innerText = "âœ… SALVO";
        }

        function voltarPara(passo) {
            document.querySelectorAll('.passo, #passo1').forEach(p => p.style.display = 'none');
            document.getElementById('passo' + passo).style.display = 'block';
        }

        function abrirMenuCadastro() {
            const nome = prompt("Nome da VTR (Ex: RPA SUL):");
            if(nome) {
                db[nome.toUpperCase()] = { modalidade: "RPA", policiais: [] };
                renderizarBotoes();
            }
        }

        window.onload = carregarDados;
    </script>
</body>
</html>

